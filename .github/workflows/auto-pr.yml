name: Auto PR & Merge

on:
    push:
        branches:
            - dev

permissions:
    contents: write
    pull-requests: write

jobs:
    auto-pr:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Create Pull Request
              id: create-pr
              run: |
                  gh pr create \
                    --base main \
                    --head dev \
                    --title "Auto PR: dev -> main" \
                    --body "Automated Pull Request from dev to main." \
                    || echo "PR likely already exists, continuing to merge step..."
              env:
                  GH_TOKEN: ${{ github.token }}

            - name: Enable Auto Merge
              run: |
                  gh pr merge dev --auto --merge
              env:
                  GH_TOKEN: ${{ github.token }}
